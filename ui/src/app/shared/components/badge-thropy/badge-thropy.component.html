<div class="ms-badge-list-container" [class.ms-badge-loading]="isLoading()">
  <div class="ms-badge-header">
    <h2 class="ms-badge-title">{{ title }}</h2>
    <p class="ms-badge-subtitle">{{ subtitle }}</p>
  </div>

  <section class="ms-badge-paths" *ngIf="badgePaths().length">
    <article class="ms-badge-path" *ngFor="let path of badgePaths()">
      <header class="ms-badge-path-header">
        <h3>{{ path.name }}</h3>
        <span class="ms-badge-path-progress"> {{ path.completedCount }} / {{ path.badges.length }} tamamland覺 </span>
      </header>

      <div class="ms-badge-path-track">
        <ng-container *ngFor="let badge of path.badges; let i = index; let last = last">
          <div class="ms-badge-path-node-wrapper">
            <button
              type="button"
              class="ms-badge-node"
              [class.ms-badge-node-selected]="selectedBadge()?.id === badge.id"
              [class.ms-badge-node-completed]="badge.isCompleted"
              (click)="selectBadge(badge)"
            >
              <span class="ms-badge-node-icon">
                <img [src]="badge.iconUrl" [alt]="badge.name" />
              </span>
              <span class="ms-badge-node-label">{{ badge.name }}</span>
              <span class="ms-badge-node-progress">{{ badge.completedLabel }} / {{ badge.totalLabel }}</span>
            </button>

            <div class="ms-badge-connector" *ngIf="!last">
              <div
                class="ms-badge-connector-line"
                [class.ms-badge-connector-active]="badge.isCompleted && path.badges[i + 1]?.isCompleted"
              ></div>
            </div>
          </div>
        </ng-container>
      </div>

      <ng-container *ngIf="selectedBadge() as selected">
        <ng-container *ngIf="selected.pathKey === path.key">
          <ng-container *ngTemplateOutlet="badgeDetail; context: { $implicit: selected }"></ng-container>
        </ng-container>
      </ng-container>
    </article>
  </section>

  <section class="ms-badge-standalone" *ngIf="standaloneBadges().length">
    <h3 class="ms-badge-standalone-title">Tekil Rozetler</h3>
    <div class="ms-badge-list">
      <div
        *ngFor="let badge of standaloneBadges(); trackBy: trackByBadgeId"
        class="ms-badge-item"
        [class.ms-badge-selected]="badge.id === selectedBadge()?.id"
        [class.ms-badge-completed]="badge.isCompleted"
        [class.ms-badge-pending]="!badge.isCompleted"
        (click)="selectBadge(badge)"
      >
        <img [src]="badge.iconUrl" [alt]="badge.name" class="ms-badge-icon" />
        <h3 class="ms-badge-name">{{ badge.name }}</h3>
        <p class="ms-badge-time">{{ badge.completedLabel }} / {{ badge.totalLabel }}</p>

        <div *ngIf="badge.id === selectedBadge()?.id" class="ms-badge-arrow"></div>
      </div>
    </div>

    <ng-container *ngIf="selectedBadge() as selected">
      <ng-container *ngIf="!selected.pathKey">
        <ng-container *ngTemplateOutlet="badgeDetail; context: { $implicit: selected }"></ng-container>
      </ng-container>
    </ng-container>
  </section>

  <div *ngIf="!badgePaths().length && !standaloneBadges().length && !isLoading()" class="ms-badge-empty">
    Rozet bilgisi bulunamad覺.
  </div>

  <ng-template #badgeDetail let-badge>
    <div class="ms-badge-detail">
      <div class="ms-badge-content" [class.ms-badge-content-completed]="badge?.isCompleted">
        <div class="ms-badge-content-top">
          <h1 class="ms-badge-title">{{ badge?.name }}</h1>

          <div class="ms-badge-meta" *ngIf="badge?.pathName">
            <span class="ms-badge-chip">{{ badge?.pathName }}</span>
            <span class="ms-badge-chip" *ngIf="badge?.pathOrder as step">Ad覺m {{ step }}</span>
          </div>

          <span class="ms-badge-description">{{ badge?.description }}</span>
          <span class="ms-badge-progress-text">{{ badge?.completedLabel }} / {{ badge?.totalLabel }} tamamland覺</span>
        </div>

        <div class="ms-badge-progress">
          <div class="ms-badge-progress-bar" [style.width.%]="badge?.progressPercent"></div>
        </div>
      </div>
    </div>
  </ng-template>
</div>
