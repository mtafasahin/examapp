<div class="program-detail-container">
  <h2 class="program-title">{{ program.programName }}</h2>
  <div class="program-meta">
    <span><mat-icon>calendar_today</mat-icon> {{ program.startDate }} - {{ program.endDate }}</span>
    <span
      ><mat-icon>assignment</mat-icon> GÃ¼nde {{ program.questionsPerDay }} soru, {{ program.subjectsPerDay }} konu</span
    >
    <span><mat-icon>timeline</mat-icon> TÃ¼r: {{ program.studyType }}</span>
  </div>

  <!-- <div class="program-stats">
    <div class="stat-box completed">
      <mat-icon>check_circle</mat-icon>
      <div>
        <div class="stat-value">{{ completedDays }}</div>
        <div class="stat-label">Uyulan GÃ¼n</div>
      </div>
    </div>
    <div class="stat-box missed">
      <mat-icon>cancel</mat-icon>
      <div>
        <div class="stat-value">{{ missedDays }}</div>
        <div class="stat-label">Uyulmayan GÃ¼n</div>
      </div>
    </div>
    <div class="stat-box total">
      <mat-icon>calendar_view_day</mat-icon>
      <div>
        <div class="stat-value">{{ totalDays }}</div>
        <div class="stat-label">Toplam GÃ¼n</div>
      </div>
    </div>
  </div> -->

  <!-- Ã–zet Kartlar -->
  <div class="summary-cards">
    <!-- <mat-card class="summary-card">
      <mat-icon>check_circle</mat-icon>
      <div>
        <div class="summary-value">{{ completedDays }}</div>
        <div class="summary-label">Uyulan GÃ¼n</div>
      </div>
    </mat-card> -->
    <mat-card class="summary-card">
      <mat-icon>assignment</mat-icon>
      <div>
        <div class="summary-value">{{ totalSolved }}</div>
        <div class="summary-label">Toplam Soru</div>
      </div>
    </mat-card>
    <mat-card class="summary-card">
      <mat-icon>timer</mat-icon>
      <div>
        <div class="summary-value">{{ totalMinutes }}</div>
        <div class="summary-label">Toplam SÃ¼re (dk)</div>
      </div>
    </mat-card>
    <mat-card class="summary-card">
      <mat-icon>percent</mat-icon>
      <div>
        <div class="summary-value">{{ successRate }}%</div>
        <div class="summary-label">BaÅŸarÄ± OranÄ±</div>
      </div>
    </mat-card>
  </div>

  <!-- IsÄ± HaritasÄ± (Heatmap) -->
  <div class="heatmap-section">
    <h3>GÃ¼nlÃ¼k Performans IsÄ± HaritasÄ±</h3>
    <ngx-charts-heat-map
      [view]="[700, 180]"
      [scheme]="heatmapScheme"
      [results]="heatmapData"
      [xAxis]="true"
      [yAxis]="true"
      [legend]="false"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      [xAxisLabel]="'GÃ¼n'"
      [yAxisLabel]="'Hafta'"
    ></ngx-charts-heat-map>
  </div>

  <!-- GÃ¼nlÃ¼k Detay Carousel -->
  <div class="day-carousel-modern">
    <button (click)="scrollDays(-1)" [disabled]="carouselIndex === 0"><mat-icon>chevron_left</mat-icon></button>
    <div class="carousel-days-list">
      <div
        *ngFor="let day of visibleDays; let i = index"
        [class.selected]="selectedDay === day"
        (click)="selectDay(day)"
      >
        <div class="day-number">{{ getRealIndex(i) + 1 }}. GÃ¼n</div>
        <div class="day-status" [class.done]="day.done" [class.missed]="!day.done">
          <mat-icon>{{ day.done ? 'check_circle' : 'cancel' }}</mat-icon>
        </div>
        <div class="day-solved">{{ day.solved }} / {{ program.questionsPerDay }} soru</div>
      </div>
    </div>
    <button (click)="scrollDays(1)" [disabled]="carouselIndex >= maxCarouselIndex">
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>

  <!-- <div class="pie-section">
    <h3>Ders BazÄ±nda Soru DaÄŸÄ±lÄ±mÄ±</h3>
    <ngx-charts-pie-chart
      [view]="[400, 220]"
      [scheme]="subjectPieScheme"
      [results]="subjectPieData"
      [legend]="true"
      [labels]="true"
      [doughnut]="true"
      [explodeSlices]="false"
      [gradient]="false"
    ></ngx-charts-pie-chart>
  </div> -->

  <!-- GÃ¼nlÃ¼k Detayda: Motivasyon, Emoji, Not, ProgressBar -->
  <div class="selected-day-detail" *ngIf="selectedDay">
    <h4>
      {{ selectedDay.date }} |
      <span [class.done]="selectedDay.done" [class.missed]="!selectedDay.done">{{
        selectedDay.done ? 'Hedefe UYULDU' : 'UYULMADI'
      }}</span>
    </h4>
    <div class="detail-row">
      <mat-icon>assignment</mat-icon> <b>{{ selectedDay.solved }}</b> soru
    </div>
    <div class="detail-row">
      <mat-icon>timer</mat-icon> <b>{{ selectedDay.minutes }}</b> dakika
    </div>
    <div class="detail-row">
      <mat-icon>mood</mat-icon> <span class="emoji">{{ selectedDay.mood }}</span>
    </div>
    <div class="detail-row">
      <mat-progress-bar
        mode="determinate"
        [value]="(selectedDay.solved / program.questionsPerDay) * 100"
      ></mat-progress-bar>
      <span class="progress-label"
        >Hedef Tamamlanma: {{ (selectedDay.solved / program.questionsPerDay) * 100 | number : '1.0-0' }}%</span
      >
    </div>
    <div class="detail-row feedback-row">
      <mat-icon>emoji_objects</mat-icon>
      <span class="motivation">{{ getMotivation(selectedDay) }}</span>
    </div>
    <div class="detail-row" *ngIf="selectedDay.subjects.length">
      <mat-icon>menu_book</mat-icon>
      <span>Dersler:</span>
      <ul>
        <li *ngFor="let s of selectedDay.subjects">
          <b>{{ s.name }}</b
          >: {{ s.solved }} soru, {{ s.minutes }} dk
        </li>
      </ul>
    </div>
    <div class="detail-row" *ngIf="selectedDay.notes">
      <mat-icon>note</mat-icon>
      <span>{{ selectedDay.notes }}</span>
    </div>
    <div class="detail-row">
      <mat-form-field appearance="outline" class="note-input">
        <mat-label>BugÃ¼nkÃ¼ Notun</mat-label>
        <input matInput [(ngModel)]="selectedDay.notes" placeholder="KÄ±sa bir not ekle..." />
      </mat-form-field>
    </div>
  </div>

  <!-- Ekstra: Streak, En Ä°yi GÃ¼n, En KÃ¶tÃ¼ GÃ¼n, Pie Chart, Not/Emoji, ProgressBar -->
  <div class="extra-stats-row">
    <mat-card class="extra-card streak">
      <mat-icon>whatshot</mat-icon>
      <div>
        <div class="extra-value">{{ currentStreak }}</div>
        <div class="extra-label">GÃ¼nlÃ¼k Streak</div>
      </div>
    </mat-card>
    <mat-card class="extra-card streak-max">
      <mat-icon>local_fire_department</mat-icon>
      <div>
        <div class="extra-value">{{ maxStreak }}</div>
        <div class="extra-label">En Uzun Streak</div>
      </div>
    </mat-card>
    <mat-card class="extra-card best" *ngIf="bestDay">
      <mat-icon>star</mat-icon>
      <div>
        <div class="extra-value">{{ bestDay.solved }}</div>
        <div class="extra-label">En Ä°yi GÃ¼n ({{ bestDay.date }})</div>
      </div>
    </mat-card>
    <mat-card class="extra-card worst" *ngIf="worstDay">
      <mat-icon>sentiment_dissatisfied</mat-icon>
      <div>
        <div class="extra-value">{{ worstDay.solved }}</div>
        <div class="extra-label">En KÃ¶tÃ¼ GÃ¼n ({{ worstDay.date }})</div>
      </div>
    </mat-card>
  </div>

  <!-- Yeni Dashboard BÃ¶lÃ¼mÃ¼ -->
  <div class="dashboard-section">
    <h3>ðŸ“Š GÃ¼nlÃ¼k Uyum OranÄ±</h3>
    <div class="subject-progress-row">
      <div *ngFor="let day of program.days" class="subject-progress">
        <span>{{ day.date | date : 'd MMM' }}</span>
        <mat-progress-bar
          mode="determinate"
          [value]="(day.solved / program.questionsPerDay) * 100"
          style="width: 80px"
        ></mat-progress-bar>
        <span>{{ (day.solved / program.questionsPerDay) * 100 | number : '1.0-0' }}%</span>
      </div>
    </div>

    <h3>ðŸ“ˆ Soru Hedefi Tamamlama GrafiÄŸi</h3>
    <ngx-charts-bar-vertical
      [view]="[600, 220]"
      [scheme]="heatmapScheme"
      [results]="barChartData"
      [xAxis]="true"
      [yAxis]="true"
      [legend]="false"
      [showXAxisLabel]="true"
      [showYAxisLabel]="true"
      [xAxisLabel]="'GÃ¼n'"
      [yAxisLabel]="'Soru'"
      [roundEdges]="true"
      [animations]="true"
    ></ngx-charts-bar-vertical>

    <h3>ðŸ“… Ã‡alÄ±ÅŸÄ±lan/Ã‡alÄ±ÅŸÄ±lmayan GÃ¼n Takvimi</h3>
    <div class="subject-progress-row">
      <div
        *ngFor="let day of program.days"
        [ngClass]="{
          'subject-progress': true,
          done: day.done,
          missed: !day.done && day.solved === 0,
          partial: !day.done && day.solved > 0
        }"
      >
        <mat-icon *ngIf="day.done">check_circle</mat-icon>
        <mat-icon *ngIf="!day.done && day.solved === 0">cancel</mat-icon>
        <mat-icon *ngIf="!day.done && day.solved > 0">hourglass_bottom</mat-icon>
        <span>{{ day.date | date : 'd MMM' }}</span>
      </div>
    </div>

    <div class="streak-badge">
      <mat-icon>local_fire_department</mat-icon>
      ðŸ”¥ {{ currentStreak }} GÃ¼nlÃ¼k Seri!
    </div>

    <div class="record-badges">
      <div class="record-badge">
        <mat-icon>star</mat-icon> En fazla soru: {{ bestDay?.solved }} ({{ bestDay?.date }})
      </div>
      <div class="record-badge">
        <mat-icon>timer</mat-icon> En uzun sÃ¼re: {{ maxMinutesDay?.minutes }} dk ({{ maxMinutesDay?.date }})
      </div>
      <div class="record-badge">
        <mat-icon>percent</mat-icon> En yÃ¼ksek uyum: {{ maxRateDay?.rate }}% ({{ maxRateDay?.date }})
      </div>
    </div>

    <div class="achievement-badges">
      <div class="achievement-badge"><mat-icon>emoji_events</mat-icon> Ä°lk 100 Soru Ã‡Ã¶zÃ¼ldÃ¼!</div>
      <div class="achievement-badge"><mat-icon>emoji_events</mat-icon> Ä°lk 5 GÃ¼n Ãœst Ãœste TamamlandÄ±</div>
      <div class="achievement-badge"><mat-icon>emoji_events</mat-icon> Toplam 1000 Soru!</div>
    </div>

    <div class="weekly-summary">
      HaftalÄ±k toplam soru: {{ weeklyTotalSolved }} | HaftalÄ±k toplam sÃ¼re: {{ weeklyTotalMinutes }} dk
    </div>

    <div class="subject-progress-row">
      <div *ngFor="let s of subjectStats" class="subject-progress">
        <mat-icon>menu_book</mat-icon> {{ s.name }}: {{ s.solved }} soru, {{ s.minutes }} dk
      </div>
    </div>

    <div class="comparison-section">
      Senin gibi 8. sÄ±nÄ±f Ã¶ÄŸrencileri haftada ortalama 150 soru Ã§Ã¶zÃ¼yor. Sen {{ weeklyTotalSolved }} soru Ã§Ã¶zdÃ¼n,
      harikasÄ±n!
    </div>

    <div class="suggestion-section">
      Son 3 gÃ¼ndÃ¼r Matematik hedefini kaÃ§Ä±rÄ±yorsun, bugÃ¼n hedefe ulaÅŸmak iÃ§in Ã¶nerilen sÃ¼re 45 dk.
    </div>
  </div>
</div>
